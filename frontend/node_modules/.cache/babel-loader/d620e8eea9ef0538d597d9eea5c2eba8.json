{"ast":null,"code":"import _objectSpread from \"C:\\\\Users\\\\82102\\\\Study_Hub\\\\Study_Project\\\\frontend\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread\";\nimport _classCallCheck from \"C:\\\\Users\\\\82102\\\\Study_Hub\\\\Study_Project\\\\frontend\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:\\\\Users\\\\82102\\\\Study_Hub\\\\Study_Project\\\\frontend\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"C:\\\\Users\\\\82102\\\\Study_Hub\\\\Study_Project\\\\frontend\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"C:\\\\Users\\\\82102\\\\Study_Hub\\\\Study_Project\\\\frontend\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"C:\\\\Users\\\\82102\\\\Study_Hub\\\\Study_Project\\\\frontend\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"C:\\\\Users\\\\82102\\\\Study_Hub\\\\Study_Project\\\\frontend\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"C:\\\\Users\\\\82102\\\\Study_Hub\\\\Study_Project\\\\frontend\\\\src\\\\components\\\\UIElements\\\\TopAppBar\\\\Avatar\\\\Avatar.js\";\nimport React, { Component, Fragment } from 'react';\nimport { Dropdown, MenuItem, Image, Clearfix, Badge } from 'react-bootstrap';\nimport './Avatar.css';\nimport apiClient from '../../../../helpers/apiClient';\nimport { withRouter } from 'react-router';\nimport PropTypes from 'prop-types';\nimport { AppContext } from '../../../../contexts/appContext';\nimport axios from 'axios';\n\nvar Avatar =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Avatar, _Component);\n\n  function Avatar(props) {\n    var _this;\n\n    _classCallCheck(this, Avatar);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Avatar).call(this, props));\n    _this.state = {\n      // 확인하지 않은 쪽지 개수\n      unseenNumber: 0\n    };\n    _this.onSelectHandler = _this.onSelectHandler.bind(_assertThisInitialized(_this));\n    _this.getUnseenMessage = _this.getUnseenMessage.bind(_assertThisInitialized(_this));\n    return _this;\n  }\n\n  _createClass(Avatar, [{\n    key: \"getUnseenMessage\",\n    value: function getUnseenMessage(data) {\n      if (data.recipient == this.context.state.signInInfo.id) {\n        this.setState(_objectSpread({}, this.state, {\n          unseenNumber: this.state.unseenNumber + data.addNum\n        }));\n      }\n    }\n  }, {\n    key: \"onSelectHandler\",\n    value: function onSelectHandler(eventKey) {\n      if (eventKey == 'mypage') {\n        this.props.history.push('/mypage');\n      } else if (eventKey == 'mymessage') {\n        this.props.history.push('/mymessagepage');\n      } else {\n        apiClient.post('/users/signout').then(function () {\n          console.log(\"logout\");\n          window.location.reload();\n        });\n      }\n    }\n    /*\r\n    static getDerivedStateFromProps(nextProps, prevState){\r\n      console.log(nextProps)\r\n      console.log(\"j\")\r\n      console.log(prevState)\r\n    } */\n\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      console.log(\"avatar mounted..\"); // 현재 로그인 유저가 읽지 않은 쪽지 개수를 요청한다. \n\n      apiClient.get('/messages/unseenmessages').then(function (unseenInfo) {\n        _this2.setState(_objectSpread({}, _this2.state, {\n          unseenNumber: unseenInfo.unseenNumber\n        }));\n      });\n      this.context.state.socketConnection.io.on('unseenMessage', function (data) {\n        return _this2.getUnseenMessage(data);\n      });\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      console.log(\"avatar unmount..\");\n      console.log(this.context.state.socketConnection.io);\n      this.context.state.socketConnection.io.removeListener('unseenMessage', this.getUnseenMessage);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return React.createElement(Dropdown, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 75\n        },\n        __self: this\n      }, React.createElement(CustomToggle, {\n        bsRole: \"toggle\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 76\n        },\n        __self: this\n      }, React.createElement(Image, {\n        className: \"userProfile\",\n        src: \"http://image.newsis.com/2018/05/28/NISI20180528_0014122801_web.jpg\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 77\n        },\n        __self: this\n      })), React.createElement(Clearfix, {\n        bsRole: \"menu\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 79\n        },\n        __self: this\n      }, React.createElement(MenuItem, {\n        eventKey: \"mypage\",\n        onSelect: this.onSelectHandler,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 80\n        },\n        __self: this\n      }, \"\\uB9C8\\uC774\\uD398\\uC774\\uC9C0\"), React.createElement(MenuItem, {\n        eventKey: \"mymessage\",\n        onSelect: this.onSelectHandler,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 81\n        },\n        __self: this\n      }, \" \", React.createElement(\"span\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 81\n        },\n        __self: this\n      }, \" \\uCABD\\uC9C0\\uD568 \"), \" \", React.createElement(Badge, {\n        style: {\n          color: 'white',\n          background: '#ff4767'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 81\n        },\n        __self: this\n      }, this.state.unseenNumber)), React.createElement(MenuItem, {\n        eventKey: \"signout\",\n        onSelect: this.onSelectHandler,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 82\n        },\n        __self: this\n      }, \"\\uB85C\\uADF8\\uC544\\uC6C3\")));\n    }\n  }]);\n\n  return Avatar;\n}(Component);\n\nAvatar.contextType = AppContext;\nAvatar.propType = {\n  history: PropTypes.object.isRequired\n};\nexport default withRouter(Avatar);\n\nvar CustomToggle =\n/*#__PURE__*/\nfunction (_Component2) {\n  _inherits(CustomToggle, _Component2);\n\n  function CustomToggle(props) {\n    var _this3;\n\n    _classCallCheck(this, CustomToggle);\n\n    _this3 = _possibleConstructorReturn(this, _getPrototypeOf(CustomToggle).call(this, props));\n    _this3.handleClick = _this3.handleClick.bind(_assertThisInitialized(_this3));\n    return _this3;\n  }\n\n  _createClass(CustomToggle, [{\n    key: \"handleClick\",\n    value: function handleClick(e) {\n      e.preventDefault();\n      this.props.onClick(e);\n      console.log(e);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return React.createElement(\"div\", {\n        onClick: this.handleClick,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 110\n        },\n        __self: this\n      }, this.props.children);\n    }\n  }]);\n\n  return CustomToggle;\n}(Component);","map":{"version":3,"sources":["C:\\Users\\82102\\Study_Hub\\Study_Project\\frontend\\src\\components\\UIElements\\TopAppBar\\Avatar\\Avatar.js"],"names":["React","Component","Fragment","Dropdown","MenuItem","Image","Clearfix","Badge","apiClient","withRouter","PropTypes","AppContext","axios","Avatar","props","state","unseenNumber","onSelectHandler","bind","getUnseenMessage","data","recipient","context","signInInfo","id","setState","addNum","eventKey","history","push","post","then","console","log","window","location","reload","get","unseenInfo","socketConnection","io","on","removeListener","color","background","contextType","propType","object","isRequired","CustomToggle","handleClick","e","preventDefault","onClick","children"],"mappings":"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","sourcesContent":["import React, { Component,Fragment } from 'react';\r\nimport {Dropdown, MenuItem, Image, Clearfix, Badge} from 'react-bootstrap';\r\nimport './Avatar.css';\r\nimport apiClient from '../../../../helpers/apiClient';\r\nimport { withRouter } from 'react-router'\r\nimport PropTypes from 'prop-types'\r\nimport {AppContext} from '../../../../contexts/appContext';\r\nimport axios from 'axios';\r\n\r\nclass Avatar extends Component{\r\n  static contextType = AppContext;\r\n\r\n  constructor(props){\r\n    super(props);\r\n    \r\n    this.state = {\r\n      // 확인하지 않은 쪽지 개수\r\n      unseenNumber : 0\r\n    }\r\n    \r\n    this.onSelectHandler = this.onSelectHandler.bind(this);\r\n    this.getUnseenMessage = this.getUnseenMessage.bind(this);\r\n  }\r\n\r\n  getUnseenMessage(data){\r\n    if (data.recipient == this.context.state.signInInfo.id){\r\n      this.setState({\r\n        ...this.state,\r\n        unseenNumber: this.state.unseenNumber + data.addNum\r\n      });\r\n    }\r\n  }\r\n\r\n  onSelectHandler (eventKey){\r\n    if (eventKey == 'mypage'){\r\n      this.props.history.push('/mypage')\r\n    }else if (eventKey == 'mymessage'){\r\n      this.props.history.push('/mymessagepage');\r\n    }else {\r\n      apiClient.post('/users/signout')\r\n      .then (()=> {console.log(\"logout\");window.location.reload()})\r\n    }\r\n  }\r\n\r\n  /*\r\n  static getDerivedStateFromProps(nextProps, prevState){\r\n    console.log(nextProps)\r\n    console.log(\"j\")\r\n    console.log(prevState)\r\n  } */\r\n\r\n  componentDidMount(){\r\n    console.log(\"avatar mounted..\");\r\n    // 현재 로그인 유저가 읽지 않은 쪽지 개수를 요청한다. \r\n\r\n    apiClient.get('/messages/unseenmessages')\r\n    .then (unseenInfo =>{\r\n      this.setState({\r\n        ...this.state,\r\n        unseenNumber: unseenInfo.unseenNumber\r\n      }) \r\n    });\r\n\r\n    this.context.state.socketConnection.io.on('unseenMessage',(data) => this.getUnseenMessage(data));\r\n  }\r\n\r\n  componentWillUnmount(){\r\n    console.log(\"avatar unmount..\");\r\n    console.log(this.context.state.socketConnection.io)\r\n    this.context.state.socketConnection.io.removeListener('unseenMessage',this.getUnseenMessage);\r\n  }\r\n\r\n  render (){\r\n    return (\r\n      <Dropdown>\r\n        <CustomToggle bsRole = \"toggle\">\r\n          <Image className = \"userProfile\" src = \"http://image.newsis.com/2018/05/28/NISI20180528_0014122801_web.jpg\"/>\r\n        </CustomToggle>\r\n        <Clearfix bsRole = \"menu\">\r\n          <MenuItem eventKey = \"mypage\" onSelect = {this.onSelectHandler}>마이페이지</MenuItem>\r\n          <MenuItem eventKey = \"mymessage\" onSelect = {this.onSelectHandler}> <span> 쪽지함 </span> <Badge style = {{color: 'white', background: '#ff4767'}}>{this.state.unseenNumber}</Badge></MenuItem>\r\n          <MenuItem eventKey = \"signout\" onSelect = {this.onSelectHandler}>로그아웃</MenuItem>\r\n        </Clearfix>\r\n      </Dropdown> )\r\n  }\r\n\r\n}\r\n\r\nAvatar.propType = {\r\n  history: PropTypes.object.isRequired,\r\n}\r\n\r\nexport default withRouter(Avatar);\r\n\r\nclass CustomToggle extends Component {\r\n  \r\n  constructor(props){\r\n    super(props);\r\n    this.handleClick = this.handleClick.bind(this);\r\n  }\r\n\r\n  handleClick(e) {\r\n    e.preventDefault();\r\n    this.props.onClick(e);\r\n    console.log(e);\r\n  }\r\n  \r\n  render() {\r\n    return (\r\n      <div onClick={this.handleClick}>\r\n        {this.props.children}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\n"]},"metadata":{},"sourceType":"module"}